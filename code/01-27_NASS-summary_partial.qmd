---
title: "USDA NASS Soybeans data"
subtitle: "Numerical and graphical summaries"
author: "All of us"
format:
  html:
    code-fold: true
    embed-resources: true
    toc: true
    number-sections: true
    theme: cerulean
    #cerulean, journal, quartz, sketchy, slate, morph, superhero, vapor
knitr: 
  opts_chunk: 
    message: false
    warning: false
---

# Introduction  
This report was developed to explore, through **tables and plots**, USDA NASS data for **soybeans production at the county level for all years available**.  

The raw data was downloaded from [USDA NASS QuickStats portal](https://quickstats.nass.usda.gov).  

# Setup  
## Loading packages  
```{r }
#install.packages('dlookr')

library(tidyverse)
library(readxl)
library(dlookr)
library(janitor)
library(ggthemes)

```

## Importing data  
```{r soy}
soy <- read_csv("../data/soybeans_nass.csv")

soy
```

# EDA  
## Print `soy`  
```{r}
soy # try to understand the ata and what is in each column.
```

## `soy` summary  
```{r }
summary(soy)

#production is yield times area
#cv is coefficient of variation
```

## Exploring column classes and distinct cases  
```{r }
soy %>%
  diagnose() #gives you a quick overview of the column classes, distinct cases, and missingness
```

```{r}
soy %>%
  distinct(County)
```

For a list of abbreviations found in NASS data sets, click [here](https://quickstats.nass.usda.gov/src/glossary.pdf).  


# Wrangling  
```{r soy_w}
soy_w <- soy %>%
  clean_names() %>%
  
  # Keeping only survey data 
  filter(program == "SURVEY") %>% #if i had selected CENSUS and not only SURVEY
  
  # Selecting desired variables
  select(year, county, 
         prod_bu = value) %>%

  # Replacing (D) for NA in prod_bu

  # Removing , from prod_bu

  # Transforming prod_bu from character to numeric

  # Transforming production from bu to million bu
  mutate(prod_mibu = prod_bu/10^6) %>%
  select(-prod_bu)
  

soy_w
```

# EDA round 2  
## Plot production distribution  

```{r }
ggplot(soy_w, aes(x = prod_mibu)) +
  geom_density() +
  geom_rug() # adds marks to show where there is a data point on the x-axis

```
Where does most of the production is distributed (eye-ball where the peak of the plot above is on the x-axis)?  

## Plot production distribution by year  

```{r }
ggplot(soy_w %>%
         filter(!(county %in% c("OTHER COUNTIES", "OTHER (COMBINED) COUNTIES"))), 
       aes(x = year,
                  y = prod_mibu,
                  group = year)) +
  geom_boxplot()


```
On same year, some counties produced near zero while others producer a lot more (~ 1 million bushels).   

## Plot production distribution by year and county  
```{r }
ggplot(soy_w, aes(x = year,
                  y = prod_mibu,
                  color = county
)) +
  geom_line(show.legend = F)

```
Kind of messy to make sense, too many lines (one for each county).    

## Table with highest production  

What was the highest production record of any county across all years? When did it happen and which county reported it?  

```{r }
soy_w %>%
  group_by(county) %>%
  filter(prod_mibu == max(prod_mibu))

soy_w %>%
  arrange(desc(prod_mibu))

soy_w %>%
  slice_max(prod_mibu, n = 5)

```

## Table with lowest production   
What was the lowest production record of any county across all years? When did it happen and which county reported it?  


```{r }
soy_w %>%
  group_by(county) %>%
  filter(prod_mibu == min(prod_mibu))

soy_w %>%
  arrange(prod_mibu)

soy_w %>%
  slice_min(prod_mibu, n = 5)

```
At an average yield of 50 bu/ac, Glascock county would've only needed 1 field of 10 ac to make this cut. That's really not much at all.  

## Plot the average county production for each year  
```{r }
soy_w %>%
  group_by(year) %>%
  summarise(meanprod = mean(prod_mibu)) %>%
  ggplot(aes(x = year,
             y = meanprod)) +
  geom_line()
  

```

## What was the latest year reported?  
```{r}
soy_w %>%
  summary()

soy_w %>%
  distinct(year) %>%
  slice_max(year)
```

## What was the highest production in 2024?  
```{r}
soy_w %>%
  filter(year == 2024) %>%
  arrange(desc(prod_mibu))

```

## Plot production over time for the highest producing county in 2024  

```{r}
soy_w %>%
  filter(county == "BROOKS") %>%
  ggplot(aes(x = year,
             y = prod_mibu)) + 
  geom_line() +
  geom_point()

```

## What was the lowest production in 2024?  
```{r}
soy_w %>%
  filter(year == 2024) %>%
  arrange(prod_mibu)
```

## Plot production over time for the lowest producing county in 2023  

```{r}
soy_w %>%
  filter(county == "ELBERT")  %>%
  ggplot(aes(x= year,
             y = prod_mibu)) +
  geom_point() +
  geom_line()

```

## Plot production over time for both of these counties above  
```{r}
soy_w %>%
  filter(county %in% c("ELBERT", "BROOKS")) %>%
  ggplot(aes(x = year,
             y = prod_mibu, 
             colour = county,
             shape = county)) +
  geom_line() +
  geom_point()


```
## Plot the state total production on each year 
```{r }
soy_w %>%
  group_by(year) %>%
  summarise(totalprod = sum(prod_mibu)) %>%
  ggplot(aes(x = year,
             y = totalprod)) +
  geom_line(color = "blue") +
  geom_point()

```
## Final: make the plot above publication-ready  

```{r }
soy_w %>%
  group_by(year) %>%
  summarise(totalprod = sum(prod_mibu)) %>%
  ggplot(aes(x = year,
             y = totalprod)) +
  geom_line(color = "blue") +
  geom_point() +
  labs(x = "Year",
       y = "Total Soybean Production (million bu)") +
  scale_x_continuous(breaks = seq(1960, 2024, 10)) +
  theme_clean()


```

```{r}
write_csv(soy_w, "../data/soybeans_nass_processed.csv")
```

